# TCP 问题整理

### TCP、UDP 区别？

|        | UDP                    | TCP                 |
| ------ | ---------------------- | ------------------- |
| 是否连接   | 无连接                    | 面向连接                |
| 是否可靠   | 不可靠传输，不使用流量控制和拥塞控制     | 可靠传输，使用流量控制和拥塞控制    |
| 连接对象个数 | 支持一对一，一对多，多对一和多对多交互通信  | 只能是一对一通信            |
| 传输方式   | 面向报文                   | 面向字节流               |
| 首部开销   | 首部开销小，仅 8 字节             | 首部最小 20 字节，最大 60 字节     |
| 适用场景   | 适用于实时应用（IP 电话、视频会议、直播等） | 适用于要求可靠传输的应用，例如文件传输 |

*   TCP 要求系统资源较多，UDP 较少

*   TCP 向上层提供面向连接的可靠服务 ，UDP 向上层提供无连接不可靠服务。

*   虽然 UDP 并没有 TCP 传输来的准确，但是也能在很多实时性要求高的地方有所作为

*   对数据准确性要求高，速度可以相对较慢的，可以选用 TCP

### TCP 实现可靠传输的方法？

*   确认和重传：接收方收到报文就会确认，发送方发送一段时间后没有收到确认就重传。

*   数据校验：TCP 报文头有校验和，用于校验报文是否损坏

*   数据合理分片和排序：tcp 会按 MTU 合理分片，接收方会缓存未按序到达的数据，重新排序后再交给应用层。而 UDP：IP 数据报大于 1500 字节，大于 MTU。这个时候发送方的 IP 层就需要分片，把数据报分成若干片，是的每一片都小于 MTU。而接收方 IP 层则需要进行数据报的重组。由于 UDP 的特性，某一片数据丢失时，接收方便无法重组数据报，导致丢弃整个 UDP 数据报。

*   流量控制：当接收方来不及处理发送方的数据，通过滑动窗口，能提示发送方降低发送的速率，防止包丢失

*   拥塞控制：当网络拥塞时，通过拥塞窗口，减少数据的发送。

### 为什么要三次握手？两次不行吗？

如客户端发出连接请求，但因连接请求报文丢失而未收到确认，于是客户端再重传一次连接请求。后来收到了确认，建立了连接。数据传输完毕后，就释放了连接，客户端共发出了两个连接请求报文段，其中第一个丢失，第二个到达了服务端，但是第一个丢失的报文段只是在某些网络结点长时间滞留了，延误到连接释放以后的某个时间才到达服务端，此时服务端误认为客户端又发出一次新的连接请求，于是就向客户端发出确认报文段，同意建立连接，不采用三次握手，只要服务端发出确认，就建立新的连接了，此时客户端忽略服务端发来的确认，也不发送数据，**则服务端一致等待客户端发送数据，浪费资源。**

### 挥手为什么需要四次？

关闭连接时，当服务端收到 FIN 报文时，很可能并不会立即关闭 SOCKET，所以只能先回复一个 ACK 报文，告诉客户端，"你发的 FIN 报文我收到了"。只有等到我服务端所有的报文都发送完了，我才能发送 FIN 报文。故需要四次挥手。

### 四次挥手释放连接时，为什么要等待 2MSL？

*   为了保证客户端发送的最后一个 ACK 报文段能够到达服务器。因为这个 ACK 有可能丢失，从而导致处在 LAST-ACK 状态的服务器收不到对 FIN-ACK 的确认报文。服务器会超时重传这个 FIN-ACK，接着客户端再重传一次确认，重新启动时间等待计时器。最后客户端和服务器都能正常的关闭。假设客户端不等待 2MSL，而是在发送完 ACK 之后直接释放关闭，一但这个 ACK 丢失的话，服务器就无法正常的进入关闭连接状态。

*   防止“已失效的连接请求报文段”出现在本连接中。客户端在发送完最后一个 ACK 报文段后，再经过 2MSL，就可以使本连接持续的时间内所产生的所有报文段都从网络中消失，使下一个新的连接中不会出现这种旧的连接请求报文段。

### SYN 攻击是什么？

SYN 攻击就是 Client 在短时间内伪造大量不存在的 IP 地址，并向 Server 不断地发送 SYN 包，Server 则回复确认包，并等待 Client 确认，由于源地址不存在，因此 Server 需要不断重发直至超时，这些伪造的 SYN 包将长时间占用未连接队列，导致正常的 SYN 请求因为队列满而被丢弃，从而引起网络拥塞甚至系统瘫痪。SYN 攻击是一种典型的 DoS/DDoS 攻击。

## 参考

*   [https://juejin.im/post/5d9c284b518825095879e7a5](https://juejin.im/post/5d9c284b518825095879e7a5 "https://juejin.im/post/5d9c284b518825095879e7a5")

*   [https://blog.csdn.net/qzcsu/article/details/72861891](https://blog.csdn.net/qzcsu/article/details/72861891 "https://blog.csdn.net/qzcsu/article/details/72861891")
